<!DOCTYPE html>
<html lang="en">
	<head>
	  <meta charset="UTF-8">
	  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <title>Page(Term)@DuckCloud</title>
	  <link rel="stylesheet" href="/regular.css"></link>
	  <script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<a href="/manage" class="logged-in-as">üö™ <nodejs-embed>username</nodejs-embed></a>
		<h1>‚òÅÔ∏è DuckCloud</h1>
		<hr>
		<a href="/" class="arrow">‚Üê</a> | <nodejs-embed>vm_name</nodejs-embed> | <a href="/shutoff/<nodejs-embed>vm_count</nodejs-embed>" onclick="document.body.insertAdjacentHTML('afterbegin','Do not click away! The page can be loading too long because Docker takes too long to stop a container.');"><nodejs-embed>switch</nodejs-embed></a> <a href="/burn/<nodejs-embed>vm_count</nodejs-embed>" onclick="return confirm('Are you sure?')">Remove VM</a> <a href="/chown/<nodejs-embed>vm_count</nodejs-embed>">Change Owner</a> <a href="/ren/<nodejs-embed>vm_count</nodejs-embed>">Rename VM</a> <a href="/settings/<nodejs-embed>vm_count</nodejs-embed>">Full-fledged terminal</a>
		<br>
		<b>Some things may be working improperly, like not-valid text being entered or no enhanced features working (\r for example).</b>
		<noscript><b>Sorry, but you cannot use the terminal of this VM.</b> If you want to use the terminal, <a href="https://enable-javascript.com/">please enable JavaScript</a>.</noscript>
		<div class="object termWidth">
			<pre class="isTerminal" id="term">
				
			</pre>
		</div>
		<textarea id="copypaste" placeholder="Copy-paste box" title="Use this for copy-pasting purposes."></textarea>
		<script>
			let socket = io();
			let doesOneThingOnly = false;
			socket.emit("resize", 80, 24);
			socket.emit("vmselect", "<nodejs-embed>vm_count</nodejs-embed>");
			socket.on("reconnect", function() {
				socket.emit("resize", 80, 24);
				socket.emit("vmselect", "<nodejs-embed>vm_count</nodejs-embed>");
			});
			socket.on("datad", function(e) {
				e = e.split("\x1b[H\x1b[2J");
				if (e.length > 1) term.innerText = "";
				e = e[e.length - 1];
				e = e.replace(/\033\[[0-9;]*[a-zA-Z]/g, "");
				e = e.replace(/\[\?2004[a-zA-Z]/g, "");
				term.innerText = term.innerText + e;
				term.scrollTop = (term.scrollTopMax || 1e100);
			});

			function doStuffWithKeyInput(e) {
				if (doesOneThingOnly) return;
				doesOneThingOnly = true;
				if (e.key.length == 1) {
					socket.emit("datad", e.key);
				} else {
					socket.emit("datad", String.fromCharCode(e.keyCode));
				}
				doesOneThingOnly = false;
			};
			onkeydown = doStuffWithKeyInput;
			
			copypaste.oninput = function() {
				if (doesOneThingOnly) return;
				doesOneThingOnly = true;
				socket.emit("datad", (copypaste.value.replace("\n", "\r")));
				copypaste.value = "";
				doesOneThingOnly = false;
			}
		</script>
	</body>
</html>